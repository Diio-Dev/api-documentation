openapi: 3.0.3
info:
  title: diio API
  description: |
    Public API documentation for diio. Allows integration with Meetings, Phone Calls, Exports, Transcripts, Playbooks, and Users.

    **Authorization:** JWT Bearer token with 1-hour expiration. Refresh using `POST /refresh_token`.

    **Content-Type:** `application/json`
  version: "1.0.0"

servers:
  - url: https://{subdomain}.diio.com/api/external
    variables:
      subdomain:
        default: your-company-subdomain
        description: Your company subdomain in diio

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Error400:
      type: object
      properties:
        error:
          type: string
          example: Bad Request
    Error401:
      type: object
      properties:
        error:
          type: string
          example: Unauthorized
    Error402:
      type: object
      properties:
        error:
          type: string
          example: Payment Required
    Error404:
      type: object
      properties:
        error:
          type: string
          example: Not Found
    Error500:
      type: object
      properties:
        error:
          type: string
          example: Internal Server Error

    Seller:
      type: object
      properties:
        name:
          type: string
          example: John Doe
        email:
          type: string
          format: email
          example: john.doe@example.com
        user_id:
          type: string
          format: uuid
          example: 99a2868c-8fa3-11f0-848f-06254876e271

    Customer:
      type: object
      properties:
        name:
          type: string
          example: Customer
        email:
          type: string
          format: email
          example: customer@client.com
        phone:
          type: string
          example: "+13055555555"

    Attendees:
      type: object
      properties:
        sellers:
          type: array
          items:
            $ref: '#/components/schemas/Seller'
        customers:
          type: array
          items:
            $ref: '#/components/schemas/Customer'

    Participant:
      type: object
      properties:
        name:
          type: string
          example: John Doe
        role:
          type: string
          enum: [seller, customer]
          example: seller
        show:
          type: boolean
          example: true
        email:
          type: string
          format: email
          example: john.doe@example.com
        user_id:
          type: string
          format: uuid
          nullable: true
          example: 99a2868c-8fa3-11f0-848f-06254876e271
        speak_time:
          type: integer
          example: 123
        arrive_time:
          type: string
          format: date-time
          example: "2025-10-01T15:12:09.146000Z"

    MeetingSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 343f605a-0bde-11f0-a454-06254876e271
        name:
          type: string
          example: Meeting with John
        scheduled_at:
          type: string
          format: date-time
          example: "2025-10-01T15:10:05"
        created_at:
          type: string
          format: date-time
          example: "2025-10-01T15:10:05"
        updated_at:
          type: string
          format: date-time
          example: "2025-10-01T15:10:05"
        last_trancript_id:
          type: string
          format: uuid
          example: 343f605a-0bde-11f0-a454-06254876e281
        attendees:
          $ref: '#/components/schemas/Attendees'
        participants:
          type: array
          items:
            $ref: '#/components/schemas/Participant'

    MeetingDetail:
      allOf:
        - $ref: '#/components/schemas/MeetingSummary'
        - type: object
          properties:
            analyzed_status:
              type: string
              enum: [finished, error]
              example: finished
            error_cause:
              type: string
              nullable: true
              example: null

    PhoneCallSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 343f605a-0bde-11f0-a454-06254876e271
        name:
          type: string
          example: Call with John
        occurred_at:
          type: string
          format: date-time
          example: "2025-10-01T15:10:05"
        created_at:
          type: string
          format: date-time
          example: "2025-10-01T15:10:05"
        updated_at:
          type: string
          format: date-time
          example: "2025-10-01T15:10:05"
        last_trancript_id:
          type: string
          format: uuid
          example: 343f605a-0bde-11f0-a454-06254876e281
        attendees:
          $ref: '#/components/schemas/Attendees'

    PhoneCallDetail:
      allOf:
        - $ref: '#/components/schemas/PhoneCallSummary'
        - type: object
          properties:
            analyzed_status:
              type: string
              enum: [finished, error]
              example: finished
            error_cause:
              type: string
              nullable: true
              example: null

    PlaybookSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 343f605a-0bde-11f0-a454-06254876e271
        name:
          type: string
          example: Call with John
        version:
          type: integer
          example: 3
        model_type:
          type: string
          enum: [meeting, phone_call, written_conversation, any]
          example: any
        updated_at:
          type: string
          format: date-time
          example: "2025-10-01T15:10:05"
        language:
          type: string
          example: es
        description:
          type: string
          example: This is the playbook description

    PlaybookDetail:
      allOf:
        - $ref: '#/components/schemas/PlaybookSummary'
        - type: object
          properties:
            trackers:
              type: array
              items:
                type: object

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 91992f26-a585-11ee-bc7e-06d5ade5f257
        name:
          type: string
          example: John Doe
        email:
          type: string
          format: email
          example: john@doe.com

    ExportStatus:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 343f605a-0bde-11f0-a454-06254876e271
        file_url:
          type: string
          nullable: true
          example: "https://example.com/343f605a-0bde-11f0-a454-06254876e271.json"
        email:
          type: string
          format: email
          example: john@doe.com
        status:
          type: string
          enum: [pending, in_progress, finished, error]
          example: finished
        created_at:
          type: string
          format: date-time
          example: "2025-01-01T01:01:01Z"

  responses:
    Unauthorized:
      description: Invalid or expired access_token. Refresh required.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error401'
    PaymentRequired:
      description: Your account is deactivated, please contact support@diio.com.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error402'
    BadRequest:
      description: Malformed request or missing required parameters.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error400'
    NotFound:
      description: The requested resource was not found.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error404'
    InternalServerError:
      description: Unexpected server error.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error500'

security:
  - BearerAuth: []

paths:

  # ─── AUTH ───────────────────────────────────────────────────────────────────

  /refresh_token:
    post:
      tags:
        - Auth
      summary: Refresh access token
      description: Refreshes and returns a new JWT access_token. Use this when your token has expired (401 response).
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - client_id
                - client_secret
                - refresh_token
              properties:
                client_id:
                  type: string
                  example: your-client-id
                client_secret:
                  type: string
                  example: your-client-secret
                refresh_token:
                  type: string
                  example: your-refresh-token
      responses:
        '200':
          description: New access_token returned successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ─── EXPORTS ────────────────────────────────────────────────────────────────

  /v1/exports:
    post:
      tags:
        - Exports
      summary: Create an export
      description: Creates a data export in JSON or CSV format. Can optionally send the file to an email address.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - file_type
              properties:
                file_type:
                  type: string
                  enum: [csv, json]
                  description: The desired export format.
                  example: json
                send_to:
                  type: string
                  format: email
                  description: Email address to send the export to.
                  example: john@doe.com
                model:
                  type: string
                  enum: [meeting, phone_call]
                  default: meeting
                  description: The model type to export.
                  example: phone_call
            example:
              file_type: json
              send_to: john@doe.com
              model: phone_call
      responses:
        '200':
          description: Export created successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                    example: 343f605a-0bde-11f0-a454-06254876e271
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '402':
          $ref: '#/components/responses/PaymentRequired'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /v1/exports/{uuid}:
    get:
      tags:
        - Exports
      summary: Get export status
      description: Queries the status and information of a previously created export by its UUID.
      parameters:
        - name: uuid
          in: path
          required: true
          description: The UUID of the export generated via POST /v1/exports.
          schema:
            type: string
            format: uuid
            example: 343f605a-0bde-11f0-a454-06254876e271
      responses:
        '200':
          description: Export details returned successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportStatus'
              examples:
                pending:
                  summary: Export is pending
                  value:
                    id: 343f605a-0bde-11f0-a454-06254876e271
                    file_url: null
                    email: john@doe.com
                    status: pending
                    created_at: "2025-01-01T01:01:01Z"
                finished:
                  summary: Export is finished
                  value:
                    id: 343f605a-0bde-11f0-a454-06254876e271
                    file_url: "https://example.com/343f605a-0bde-11f0-a454-06254876e271.json"
                    email: john@doe.com
                    status: finished
                    created_at: "2025-01-01T01:01:01Z"
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '402':
          $ref: '#/components/responses/PaymentRequired'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── MEETINGS ───────────────────────────────────────────────────────────────

  /v1/meetings:
    get:
      tags:
        - Meetings
      summary: List meetings
      description: Returns a paginated list of meetings in your diio account.
      parameters:
        - name: page
          in: query
          required: false
          description: The page number.
          schema:
            type: integer
            example: 1
        - name: limit
          in: query
          required: false
          description: The number of meetings to return per page.
          schema:
            type: integer
            example: 20
      responses:
        '200':
          description: List of meetings returned successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  meetings:
                    type: array
                    items:
                      $ref: '#/components/schemas/MeetingSummary'
                  total:
                    type: integer
                    example: 1000
                  next:
                    type: integer
                    nullable: true
                    example: 2
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '402':
          $ref: '#/components/responses/PaymentRequired'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /v1/meetings/{id}:
    get:
      tags:
        - Meetings
      summary: Get a meeting
      description: Returns detailed information for a specific meeting.
      parameters:
        - name: id
          in: path
          required: true
          description: The UUID of the meeting.
          schema:
            type: string
            format: uuid
            example: 343f605a-0bde-11f0-a454-06254876e271
      responses:
        '200':
          description: Meeting details returned successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MeetingDetail'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '402':
          $ref: '#/components/responses/PaymentRequired'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── PHONE CALLS ────────────────────────────────────────────────────────────

  /v1/phone_calls:
    post:
      tags:
        - Phone Calls
      summary: Create a phone call
      description: Creates a Phone Call record to be analyzed in diio.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - media_url
                - duration
                - user_id
                - call_from_number
                - customer_name
                - customer_email
                - customer_phone
                - occurred_at
              properties:
                name:
                  type: string
                  description: Display name for the call.
                  example: Call with John
                media_url:
                  type: string
                  format: uri
                  description: URL where diio can fetch the call recording.
                  example: https://example.com/location-of-phone-call.mp3
                duration:
                  type: integer
                  description: Duration of the call in seconds.
                  example: 600
                user_id:
                  type: string
                  format: uuid
                  description: UUID of the diio user associated with the call.
                  example: c2d83840-fb6d-11ef-b70f-06254876e271
                call_from_number:
                  type: string
                  description: The phone number from which the call was made.
                  example: "+130512341234"
                customer_name:
                  type: string
                  description: Name of the customer that was called.
                  example: John Doe
                customer_email:
                  type: string
                  format: email
                  description: Email of the customer that was called.
                  example: john@doe.com
                customer_phone:
                  type: string
                  description: Phone number of the customer that was called.
                  example: "+130543214321"
                occurred_at:
                  type: string
                  format: date-time
                  description: UTC datetime when the call occurred.
                  example: "2025-10-01T15:10:05"
      responses:
        '200':
          description: Phone call created successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                    example: 343f605a-0bde-11f0-a454-06254876e271
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '402':
          $ref: '#/components/responses/PaymentRequired'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      tags:
        - Phone Calls
      summary: List phone calls
      description: Returns a paginated list of phone calls in your diio account.
      parameters:
        - name: page
          in: query
          required: false
          description: The page number.
          schema:
            type: integer
            example: 1
        - name: limit
          in: query
          required: false
          description: Number of phone calls to return per page.
          schema:
            type: integer
            example: 20
      responses:
        '200':
          description: List of phone calls returned successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  phone_calls:
                    type: array
                    items:
                      $ref: '#/components/schemas/PhoneCallSummary'
                  total:
                    type: integer
                    example: 1000
                  next:
                    type: integer
                    nullable: true
                    example: 2
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '402':
          $ref: '#/components/responses/PaymentRequired'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /v1/phone_calls/{id}:
    get:
      tags:
        - Phone Calls
      summary: Get a phone call
      description: Returns detailed information for a specific phone call.
      parameters:
        - name: id
          in: path
          required: true
          description: The UUID of the phone call.
          schema:
            type: string
            format: uuid
            example: 343f605a-0bde-11f0-a454-06254876e271
      responses:
        '200':
          description: Phone call details returned successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PhoneCallDetail'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '402':
          $ref: '#/components/responses/PaymentRequired'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      tags:
        - Phone Calls
      summary: Update a phone call
      description: Edit information for a specific phone call in your diio account.
      parameters:
        - name: id
          in: path
          required: true
          description: The UUID of the phone call.
          schema:
            type: string
            format: uuid
            example: 343f605a-0bde-11f0-a454-06254876e271
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: New name for the phone call.
                  example: Call with John - updated
                media_url:
                  type: string
                  format: uri
                  description: New URL for the call recording.
                  example: https://example.com/new-location.mp3
                call_from_number:
                  type: string
                  description: Updated number from which the call was made.
                  example: "+130512341234"
                customer_name:
                  type: string
                  description: Updated customer name.
                  example: John Doe
                customer_email:
                  type: string
                  format: email
                  description: Updated customer email.
                  example: john@doe.com
                customer_phone:
                  type: string
                  description: Updated customer phone number.
                  example: "+130543214321"
      responses:
        '200':
          description: Phone call updated successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                    example: 343f605a-0bde-11f0-a454-06254876e271
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '402':
          $ref: '#/components/responses/PaymentRequired'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── PLAYBOOKS ──────────────────────────────────────────────────────────────

  /v1/playbooks:
    get:
      tags:
        - Playbooks
      summary: List playbooks
      description: Returns a paginated list of playbooks in your diio account.
      parameters:
        - name: page
          in: query
          required: false
          description: The page number.
          schema:
            type: integer
            example: 1
        - name: limit
          in: query
          required: false
          description: Number of playbooks to return per page.
          schema:
            type: integer
            example: 20
      responses:
        '200':
          description: List of playbooks returned successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  playbooks:
                    type: array
                    items:
                      $ref: '#/components/schemas/PlaybookSummary'
                  total:
                    type: integer
                    example: 1000
                  next:
                    type: integer
                    nullable: true
                    example: 2
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '402':
          $ref: '#/components/responses/PaymentRequired'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /v1/playbooks/{id}:
    get:
      tags:
        - Playbooks
      summary: Get a playbook
      description: Returns detailed information for a specific playbook including its trackers.
      parameters:
        - name: id
          in: path
          required: true
          description: The UUID of the playbook.
          schema:
            type: string
            format: uuid
            example: 343f605a-0bde-11f0-a454-06254876e271
      responses:
        '200':
          description: Playbook details returned successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlaybookDetail'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '402':
          $ref: '#/components/responses/PaymentRequired'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── TRANSCRIPTS ────────────────────────────────────────────────────────────

  /v1/transcripts/{id}:
    get:
      tags:
        - Transcripts
      summary: Get a transcript
      description: Returns a transcript object associated to a diio object (phone call or meeting).
      parameters:
        - name: id
          in: path
          required: true
          description: The UUID of the transcript.
          schema:
            type: string
            format: uuid
            example: 91992f26-a585-11ee-bc7e-06d5ade5f257
        - name: email
          in: query
          required: false
          description: Filter transcript information by user email.
          schema:
            type: string
            format: email
            example: john@doe.com
      responses:
        '200':
          description: Transcript returned successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                    example: 91992f26-a585-11ee-bc7e-06d5ade5f257
                  transcript:
                    type: string
                    example: Lorem ipsum...
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '402':
          $ref: '#/components/responses/PaymentRequired'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ─── USERS ──────────────────────────────────────────────────────────────────

  /v1/users:
    get:
      tags:
        - Users
      summary: List users
      description: Returns a list of all users in your diio account. Can be filtered by email. Limit is 10 users per page.
      parameters:
        - name: page
          in: query
          required: false
          description: The page number (10 users per page).
          schema:
            type: integer
            example: 1
        - name: email
          in: query
          required: false
          description: Filter by a specific user's email.
          schema:
            type: string
            format: email
            example: john@doe.com
      responses:
        '200':
          description: List of users returned successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
              example:
                users:
                  - name: John Doe
                    email: john@doe.com
                    id: 91992f26-a585-11ee-bc7e-06d5ade5f257
                  - name: Jane Doe
                    email: jane@doe.com
                    id: 0b3e264a-9b83-11ee-9bd5-06d5ade5f257
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '402':
          $ref: '#/components/responses/PaymentRequired'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
